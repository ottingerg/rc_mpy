<!DOCTYPE html>
  <html >
  <body >
  <canvas id = "canvas_xy" width = "400" height = "400"
  style = "background-color:#333" >
  </canvas >
  <canvas id = "canvas_leveler" width = "60" height = "340" 
  style = "position: absolute; top: 10; background-color:#333" >
  </canvas > 
  <canvas id = "canvas_lights" width = "60" height = "60"
  style = "background-color:#333" >
  </canvas > 

<script > 
var canvas_xy = document.getElementById ("canvas_xy");
var canvas_leveler = document.getElementById ("canvas_leveler");
var canvas_lights = document.getElementById ("canvas_lights");

var ctr_xy = new controller (42, 42, "red", canvas_xy);
var ctr_leveler = new controller (60, 20, "gray", canvas_leveler);
var swi_lights = new toggle_switch( "green", canvas_lights);

ctr_xy.init();
ctr_leveler.init();

canvas_xy.addEventListener ("mousemove", function (event)
			    {
			    ctr_xy.moved (event);
			    }

			    , false);
canvas_xy.addEventListener ("mouseup", function (event) { ctr_xy.init(); }, false);
canvas_leveler.addEventListener ("mousemove", function (event)
				 {
				 ctr_leveler.moved (event);
				 }

				 , false);

canvas_lights.addEventListener ("click", function (event) { swi_lights.toggle(event); }, false);

function 
toggle_switch (color,canvas)
{
  this.color = color;
  this.canvas = canvas;
  this.state = false;

  this.toggle = function (event) 
  {
    var ctx = this.canvas.getContext ("2d");

    if(this.state) 
    {
      this.state = false;
      ctx.clearRect (0,0, this.canvas.width, this.canvas.height);
    } else {
      this.state = true;
      ctx.fillStyle = this.color;
      ctx.fillRect (0,0, this.canvas.width, this.canvas.height);
      ctx.fill();
    }
  }
}
      
function
controller (width, height, color, canvas)
{
  this.width = width;
  this.height = height;
  this.color = color;
  this.canvas = canvas;
  this.xold = 0
  this.yold = 0

  this.init = function() { this.update(this.canvas.width/2, this.canvas.height/2) };

  this.update = function (x, y)
  {
    var ctx = this.canvas.getContext ("2d");
    ctx.clearRect (this.xold - width / 2, this.yold - height / 2, width, height);

    if (x + width / 2 > this.canvas.width)
      x = this.canvas.width - width / 2;
    if (y + height / 2 > this.canvas.height)
      y = this.canvas.height - height / 2;
    if (x - width / 2 < 0)
      x = width / 2;
    if (y - height / 2 < 0)
      y = height / 2;

    this.xold = x;
    this.yold = y;

    ctx.fillStyle = this.color;
    ctx.fillRect (x - width / 2, y - height / 2, width, height);    
    ctx.fill ();
  }

  this.moved = function (event)
  {
    if (!event.buttons && event.type != "click") return;
    var rect = this.canvas.getBoundingClientRect ();
    var x = event.clientX - rect.left;
    var y = event.clientY - rect.top;
    this.update (x, y);
  }
}

</script > </body > </html >
